<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Data Setting</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#18A0FB',
                        'primary-hover': '#0D86D8',
                        surface: '#F9F9F9',
                        border: '#E0E0E0',
                        'border-strong': '#BDBDBD',
                        danger: '#F24822',
                        text: '#333333',
                        'text-sub': '#888888'
                    },
                    fontSize: {
                        xxs: '10px',
                        xs: '11px',
                        sm: '12px'
                    },
                    boxShadow: {
                        'left-scroll': '-4px 0 12px -4px rgba(0, 0, 0, 0.1)',
                        'top-scroll': '0 -4px 12px -4px rgba(0, 0, 0, 0.1)'
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .step { display: none; opacity: 0; transform: translateY(2px); transition: all 0.3s ease-in-out; }
        .step.active { display: flex; opacity: 1; transform: translateY(0); }
        
        /* 스크롤바 커스텀 */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-thumb { background: #D1D5DB; border-radius: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
    </style>
</head>
<body class="bg-white text-text p-3 flex flex-col gap-3 h-screen box-border text-xs overflow-hidden">

    <header class="flex justify-between items-center h-8 shrink-0">
        <h1 class="text-sm font-semibold flex items-center m-0">
            <button id="back-btn" class="hidden text-text-sub hover:text-text bg-transparent border-0 cursor-pointer p-1 mr-1" title="Back">
                <svg class="w-3 h-3 fill-current" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            Chart Data 
            <span id="chart-type-display" class="hidden text-xxs font-medium bg-surface border border-border px-1.5 py-0.5 rounded ml-2 text-text-sub">Bar</span>
        </h1>
        <button id="main-cta" disabled class="bg-primary text-white px-3 py-1.5 rounded font-semibold text-xs cursor-pointer transition-colors hover:bg-primary-hover disabled:bg-surface disabled:text-text-sub disabled:border disabled:border-border disabled:cursor-not-allowed">
            Apply to Figma
        </button>
    </header>

    <div id="step-1" class="step active flex-col gap-3 w-full">
        <div class="border border-border rounded-md p-3 bg-white flex flex-col gap-2">
            <h2 class="text-xs font-semibold text-text-sub m-0 mb-1">Select Chart Type</h2>
            <div class="grid grid-cols-2 gap-3 mt-2">
                <button class="bg-white border border-border rounded-md py-6 px-3 flex flex-col items-center justify-center cursor-pointer transition-all hover:border-primary hover:bg-blue-50 hover:shadow-sm" onclick="selectType('bar')">
                    <svg class="w-8 h-8 fill-primary mb-2" viewBox="0 0 24 24"><path d="M4 19h4v-7H4v7zm6 0h4V9h-4v10zm6-14v14h4V5h-4zm2-4H2v22h22V1h-2z"/></svg>
                    <span class="font-semibold text-text">Bar Chart</span>
                </button>
                <button class="bg-white border border-border rounded-md py-6 px-3 flex flex-col items-center justify-center cursor-pointer transition-all hover:border-primary hover:bg-blue-50 hover:shadow-sm" onclick="selectType('line')">
                    <svg class="w-8 h-8 fill-primary mb-2" viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg>
                    <span class="font-semibold text-text">Line Chart</span>
                </button>
                <button class="bg-white border border-border rounded-md py-6 px-3 flex flex-col items-center justify-center cursor-pointer transition-all hover:border-primary hover:bg-blue-50 hover:shadow-sm" onclick="selectType('stackedBar')">
                    <svg class="w-8 h-8 fill-primary mb-2" viewBox="0 0 24 24"><path d="M4 19h4v-4H4v4zm0-5h4v-3H4v3zm0-4h4V7H4v3zm6 9h4v-8h-4v8zm0-9h4V7h-4v3zm0-4h4V2h-4v4zm6 13h4v-6h-4v6zm0-7h4V7h-4v3zm0-4h4V2h-4v4z"/></svg>
                    <span class="font-semibold text-text">Stacked Bar</span>
                </button>
            </div>
        </div>
    </div>

    <div id="step-2" class="step flex-col gap-3 w-full h-full overflow-hidden">
        
        <div class="border border-border rounded-md p-3 bg-white flex flex-col gap-2 shrink-0">
            <h2 class="text-xs font-semibold text-text-sub m-0 mb-1">Import from CSV</h2>
            <div class="flex items-center justify-between bg-surface px-3 py-2 rounded-md border border-dashed border-border group">
                <span id="csv-status-text" class="text-xs text-text-sub truncate mr-2">csv를 업로드해주세요.</span>
                
                <div class="flex items-center gap-2 shrink-0">
                    <button id="csv-delete-btn" class="hidden w-5 h-5 flex items-center justify-center rounded-full bg-gray-200 hover:bg-danger hover:text-white text-gray-500 transition-colors cursor-pointer" title="Remove CSV">
                        <svg class="w-3 h-3 fill-current" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                    </button>

                    <label for="csv-upload" class="bg-white border border-border rounded px-2.5 py-1 text-xxs font-medium text-text cursor-pointer hover:border-text-sub hover:bg-gray-100 transition-all whitespace-nowrap">
                        Choose CSV
                    </label>
                    <input type="file" id="csv-upload" accept=".csv" class="hidden">
                </div>
            </div>
        </div>

        <div id="editor-card" class="border border-border rounded-md bg-white flex flex-col flex-1 overflow-hidden">
            <div class="px-3 border-b border-border flex justify-between items-center bg-white shrink-0 h-8">
                <div class="flex gap-3 items-center">
                    <div class="flex items-center gap-1.5">
                        <label class="text-xs text-text-sub font-medium">Rows</label>
                        <input type="number" id="row-input" value="3" min="1" max="25" class="w-9 px-1 py-0.5 border border-border rounded text-center text-xs h-5.5 focus:border-primary focus:outline-none">
                    </div>
                    <div class="flex items-center gap-1.5">
                        <label class="text-xs text-text-sub font-medium">Cols</label>
                        <input type="number" id="col-input" value="3" min="1" max="25" class="w-9 px-1 py-0.5 border border-border rounded text-center text-xs h-5.5 focus:border-primary focus:outline-none">
                    </div>
                </div>
            </div>

            <div id="grid-container-wrapper" class="flex flex-1 relative overflow-hidden bg-white max-h-[300px]">
                
                <div id="grid-scroll-area" class="flex-1 overflow-auto relative scroll-smooth">
                    <div id="data-grid" class="grid gap-0 border-t border-l border-border w-fit">
                        </div>
                </div>

                <div class="w-8 shrink-0 border-l border-b border-t border-border bg-white flex flex-col z-20 shadow-left-scroll">
                    <div class="h-6 border-b border-border-strong bg-surface flex items-center justify-center shrink-0">
                        <svg class="w-3 h-3 fill-text-sub" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    </div>
                    <button id="add-col-fixed-btn" class="flex-1 w-full text-primary hover:bg-surface flex items-center justify-center cursor-pointer font-medium text-lg focus:outline-none active:bg-blue-50 transition-colors" title="Add Column">
                        +
                    </button>
                </div>
            </div>

            <div class="h-7 flex shrink-0 border-t border-border bg-white z-20 shadow-top-scroll">
                <button id="add-row-fixed-btn" class="flex-1 text-primary hover:bg-surface flex items-center justify-center cursor-pointer text-xs font-medium focus:outline-none active:bg-blue-50 transition-colors">
                    + Add Row
                </button>
                <div class="w-8 shrink-0 border-l border-border bg-surface"></div>
            </div>

            <div class="px-3 border-t border-border bg-white flex justify-end shrink-0 h-8 items-center">
                <button id="save-btn" class="bg-transparent text-text border border-text px-2.5 py-0.5 rounded cursor-pointer font-medium text-xs min-w-[60px] h-5.5 hover:bg-surface transition-colors">Save</button>
            </div>
        </div>
    </div>

    <div id="restore-toast" class="hidden fixed bottom-14 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs px-4 py-3 rounded-md shadow-lg z-50 flex items-center gap-4 transition-all duration-300 opacity-0 translate-y-2">
        <span>데이터를 다시 적용하겠습니까?</span>
        <div class="flex items-center gap-3">
            <button id="toast-yes-btn" class="font-bold text-primary hover:text-blue-300 cursor-pointer">예</button>
            <button id="toast-close-btn" class="text-gray-400 hover:text-white cursor-pointer">✕</button>
        </div>
    </div>

    <script>
        const MAX_SIZE = 25;
        const state = {
            rows: 3, cols: 3, data: [], 
            mode: 'edit', chartType: 'bar', dataMode: 'percent', 
            currentStep: 1,
            csvFileName: null,
            uiMode: 'create' // [NEW] create | edit
        };

        const ui = {
            step1: document.getElementById('step-1'),
            step2: document.getElementById('step-2'),
            backBtn: document.getElementById('back-btn'),
            mainCta: document.getElementById('main-cta'),
            chartTypeDisplay: document.getElementById('chart-type-display'),
            csvInput: document.getElementById('csv-upload'),
            csvStatusText: document.getElementById('csv-status-text'),
            csvDeleteBtn: document.getElementById('csv-delete-btn'), 
            rowInput: document.getElementById('row-input'),
            colInput: document.getElementById('col-input'),
            
            gridScrollArea: document.getElementById('grid-scroll-area'),
            gridContainer: document.getElementById('data-grid'),
            
            addColFixedBtn: document.getElementById('add-col-fixed-btn'),
            addRowFixedBtn: document.getElementById('add-row-fixed-btn'),
            saveBtn: document.getElementById('save-btn'),

            // Toast Elements
            toast: document.getElementById('restore-toast'),
            toastYesBtn: document.getElementById('toast-yes-btn'),
            toastCloseBtn: document.getElementById('toast-close-btn'),
        };

        let tempLastValues = null; 

        // --- Toast Functions ---
        function showToast() {
            ui.toast.classList.remove('hidden');
            setTimeout(() => {
                ui.toast.classList.remove('opacity-0', 'translate-y-2');
            }, 50);
        }

        function hideToast() {
            ui.toast.classList.add('opacity-0', 'translate-y-2');
            setTimeout(() => {
                ui.toast.classList.add('hidden');
            }, 300);
        }

        ui.toastCloseBtn.addEventListener('click', hideToast);

        ui.toastYesBtn.addEventListener('click', () => {
            if (tempLastValues && Array.isArray(tempLastValues)) {
                // 1. 데이터 복원 (1차원 배열 기준)
                const len = tempLastValues.length;
                const newRows = state.rows; 
                const newCols = len > 0 ? len : 3;

                const newData = [];
                const rowData = tempLastValues.map(v => String(v));
                
                for(let r=0; r<newRows; r++) {
                    if (r === 0) newData.push(rowData); 
                    else newData.push(new Array(newCols).fill(""));
                }

                state.cols = newCols;
                state.data = newData;
                state.dataMode = 'raw'; 

                // 2. UI 업데이트
                updateInputs();
                renderGrid();
                checkCtaValidation();
                
                // 3. 즉시 Apply 실행
                submitData();

                hideToast();
            }
        });
        // -----------------------

        function updateCsvUi() {
            if (!ui.csvStatusText) return;
            const isUploaded = !!state.csvFileName;
            
            if (isUploaded) {
                ui.csvStatusText.textContent = state.csvFileName;
                ui.csvStatusText.className = 'text-xs text-primary font-semibold';
                ui.csvDeleteBtn.classList.remove('hidden');
            } else {
                ui.csvStatusText.textContent = "csv를 업로드해주세요.";
                ui.csvStatusText.className = 'text-xs text-text-sub truncate mr-2';
                ui.csvDeleteBtn.classList.add('hidden');
            }
        }

        function removeCsv() {
            state.csvFileName = null;
            ui.csvInput.value = '';
            updateCsvUi();
        }

        function goToStep(stepNum) {
            state.currentStep = stepNum;
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            if (stepNum === 1) {
                ui.step1.classList.add('active');
                ui.backBtn.classList.add('hidden');
                ui.chartTypeDisplay.classList.add('hidden');
                ui.mainCta.style.display = 'none';
                
                removeCsv();
                
                parent.postMessage({ pluginMessage: { type: 'resize', width: 300, height: 400 } }, '*');
            } else {
                ui.step2.classList.add('active');
                ui.backBtn.classList.remove('hidden');
                ui.chartTypeDisplay.classList.remove('hidden');
                ui.chartTypeDisplay.textContent = state.chartType;
                
                // [NEW] 상태에 따라 버튼 텍스트 변경
                ui.mainCta.style.display = 'block';
                ui.mainCta.textContent = state.uiMode === 'create' ? "Generate to Figma" : "Apply to Figma";

                renderGrid();
                checkCtaValidation();
                
                parent.postMessage({ pluginMessage: { type: 'resize', width: 600, height: 520 } }, '*');
            }
        }

        window.selectType = function(type) {
            state.chartType = type;
            state.dataMode = 'raw'; 
            goToStep(2);
        };

        ui.backBtn.addEventListener('click', () => {
            goToStep(1);
            hideToast();
        });

        function initData(r, c) {
            const newData = [];
            for (let i = 0; i < r; i++) {
                const row = new Array(c).fill("");
                newData.push(row);
            }
            return newData;
        }
        state.data = initData(state.rows, state.cols);

        window.onmessage = (event) => {
            const msg = event.data.pluginMessage;
            if (!msg) return;
            
            if (msg.type === 'init') {
                // [NEW] 초기화 시 모드 저장
                state.uiMode = msg.uiMode || 'create';

                if (msg.chartType) {
                    state.chartType = msg.chartType;
                    
                    // 역산 데이터 적용
                    if (msg.values && Array.isArray(msg.values)) {
                        const vals = msg.values;
                        if (state.chartType === 'bar' || state.chartType === 'line') {
                            state.rows = 1; 
                            state.cols = vals.length > 0 ? vals.length : 3;
                            state.data = [ vals.map(v => String(v)) ];
                        } else if (state.chartType === 'stackedBar') {
                            state.cols = vals.length;
                            let maxRows = 0;
                            vals.forEach(col => { if(col.length > maxRows) maxRows = col.length; });
                            state.rows = maxRows > 0 ? maxRows : 3;
                            const newData = [];
                            for(let r=0; r<state.rows; r++){
                                const rowData = [];
                                for(let c=0; c<state.cols; c++){
                                    const val = (vals[c] && vals[c][r] !== undefined) ? String(vals[c][r]) : "";
                                    rowData.push(val);
                                }
                                newData.push(rowData);
                            }
                            state.data = newData;
                        }
                    }
                    
                    updateInputs();
                    goToStep(2); // 수정 모드면 Step 2로 직행

                    // [Toast Logic]
                    if (msg.isModified && msg.lastValues && msg.values) {
                        tempLastValues = msg.lastValues;
                        
                        const currentJson = JSON.stringify(msg.values);
                        const lastJson = JSON.stringify(msg.lastValues);
                        
                        if (currentJson !== lastJson) {
                            setTimeout(showToast, 500);
                        }
                    }

                } else {
                    goToStep(1); // 생성 모드면 Step 1로 시작
                }
            }
        };

        function renderGrid() {
            ui.gridContainer.innerHTML = ''; 
            ui.gridContainer.style.gridTemplateColumns = `repeat(${state.cols}, minmax(60px, 1fr))`;

            // 1. 헤더 생성
            for (let j = 0; j < state.cols; j++) {
                const headerCell = document.createElement('div');
                headerCell.className = 'sticky top-0 z-20 bg-surface border-r border-b border-border-strong flex items-center justify-center h-6 text-xxs font-semibold text-text-sub group relative';
                headerCell.innerHTML = `<span>${j + 1}</span>`;
                if (state.mode === 'edit') {
                    const delBtn = document.createElement('button');
                    delBtn.className = 'absolute right-0.5 top-1/2 -translate-y-1/2 w-4 h-4 hidden group-hover:flex items-center justify-center bg-transparent border-0 cursor-pointer text-text-sub hover:text-danger';
                    delBtn.innerHTML = `<svg class="w-3 h-3 fill-current" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>`;
                    delBtn.onclick = () => deleteColumn(j);
                    headerCell.appendChild(delBtn);
                }
                ui.gridContainer.appendChild(headerCell);
            }

            // 2. 데이터 셀 생성
            state.data.forEach((row, rowIndex) => {
                const isZebra = (rowIndex % 2 === 1);
                row.forEach((cellValue, colIndex) => {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = cellValue;
                    input.dataset.row = rowIndex;
                    input.dataset.col = colIndex;
                    let classes = 'w-full h-6 px-2 border-0 border-r border-b border-border-strong text-xs text-right bg-white focus:outline-none focus:ring-1 focus:ring-primary focus:z-10 relative';
                    if (isZebra) classes += ' bg-surface'; 
                    if (state.mode === 'read') classes += ' bg-gray-50 text-gray-400 cursor-not-allowed';
                    input.className = classes;
                    input.addEventListener('input', (e) => {
                        state.data[rowIndex][colIndex] = e.target.value;
                        checkCtaValidation();
                    });
                    ui.gridContainer.appendChild(input);
                });
            });
            
            checkCtaValidation();
        }

        function handleDimensionInput() {
            let newRows = parseInt(ui.rowInput.value);
            let newCols = parseInt(ui.colInput.value);
            if (newRows < 1) newRows = 1; if (newRows > MAX_SIZE) newRows = MAX_SIZE;
            if (newCols < 1) newCols = 1; if (newCols > MAX_SIZE) newCols = MAX_SIZE;
            updateGridSize(newRows, newCols);
        }

        function updateGridSize(newRows, newCols) {
            const newData = [];
            for (let i = 0; i < newRows; i++) {
                const newRow = [];
                for (let j = 0; j < newCols; j++) {
                    if (i < state.rows && j < state.cols) {
                        newRow.push((state.data[i] && state.data[i][j] !== undefined) ? state.data[i][j] : "");
                    } else {
                        newRow.push("");
                    }
                }
                newData.push(newRow);
            }
            state.rows = newRows;
            state.cols = newCols;
            state.data = newData;
            renderGrid();
        }

        function addColumn() {
            if (state.cols >= MAX_SIZE) return;
            updateGridSize(state.rows, state.cols + 1);
            updateInputs();
            setTimeout(() => {
                ui.gridScrollArea.scrollTo({ left: ui.gridScrollArea.scrollWidth, behavior: 'smooth' });
            }, 50);
        }

        function addRow() {
            if (state.rows >= MAX_SIZE) return;
            updateGridSize(state.rows + 1, state.cols);
            updateInputs();
            setTimeout(() => {
                ui.gridScrollArea.scrollTo({ top: ui.gridScrollArea.scrollHeight, behavior: 'smooth' });
            }, 50);
        }

        function deleteColumn(colIndex) {
            if (state.cols <= 1) return;
            state.data.forEach(row => row.splice(colIndex, 1));
            state.cols--;
            updateInputs();
            renderGrid();
        }
        function updateInputs() {
            ui.rowInput.value = state.rows;
            ui.colInput.value = state.cols;
        }

        function handleCsvUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            state.csvFileName = file.name;
            updateCsvUi();
            const reader = new FileReader();
            reader.onload = function(e) { parseAndApplyCsv(e.target.result); };
            reader.readAsText(file);
        }

        function parseAndApplyCsv(csvText) {
            const rows = csvText.split(/\r?\n/).filter(r => r.trim() !== '');
            if (rows.length === 0) return;
            let newRowsCount = rows.length;
            let newColsCount = rows[0].split(',').length;
            if (newRowsCount > MAX_SIZE) newRowsCount = MAX_SIZE;
            if (newColsCount > MAX_SIZE) newColsCount = MAX_SIZE;
            const newData = [];
            for (let i = 0; i < newRowsCount; i++) {
                const cells = rows[i].split(',');
                const newRow = cells.slice(0, newColsCount); 
                newData.push(newRow);
            }
            state.data = newData;
            state.rows = newRowsCount;
            state.cols = newColsCount;
            state.dataMode = 'raw'; 
            updateInputs(); 
            renderGrid();
            updateCsvUi();
            ui.csvInput.value = '';
        }

        function toggleMode() {
            if (state.mode === 'edit') {
                state.mode = 'read';
                ui.saveBtn.textContent = "Edit Mode"; 
                ui.saveBtn.className = 'bg-primary text-white border border-primary px-2.5 py-0.5 rounded cursor-pointer font-medium text-xs min-w-[60px] h-5.5 hover:bg-primary-hover transition-colors';
                ui.rowInput.disabled = true; ui.colInput.disabled = true;
                
                [ui.addColFixedBtn, ui.addRowFixedBtn].forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('text-text-sub', 'cursor-not-allowed');
                    btn.classList.remove('text-primary', 'hover:bg-surface', 'cursor-pointer');
                });
            } else {
                state.mode = 'edit';
                ui.saveBtn.textContent = "Save";
                ui.saveBtn.className = 'bg-transparent text-text border border-text px-2.5 py-0.5 rounded cursor-pointer font-medium text-xs min-w-[60px] h-5.5 hover:bg-surface transition-colors';
                ui.rowInput.disabled = false; ui.colInput.disabled = false;
                
                [ui.addColFixedBtn, ui.addRowFixedBtn].forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('text-text-sub', 'cursor-not-allowed');
                    btn.classList.add('text-primary', 'hover:bg-surface', 'cursor-pointer');
                });
            }
            renderGrid(); checkCtaValidation(); 
        }

        function checkCtaValidation() {
            if (state.mode !== 'read') { ui.mainCta.disabled = true; return; }
            let isAllFilled = true;
            for (let i = 0; i < state.rows; i++) {
                for (let j = 0; j < state.cols; j++) {
                    if (!state.data[i][j] || state.data[i][j].trim() === "") {
                        isAllFilled = false; break;
                    }
                }
                if (!isAllFilled) break;
            }
            ui.mainCta.disabled = !isAllFilled;
        }

        function submitData() {
            let payloadValues;
            const numberData = state.data.map(row => 
                row.map(cell => {
                    const num = Number(cell);
                    return isNaN(num) ? 0 : num;
                })
            );
            if (state.chartType === 'stackedBar') {
                payloadValues = numberData;
            } else {
                payloadValues = numberData.flat();
            }

            // [NEW] 모드에 따라 전송 타입 분기 ('generate' vs 'apply')
            const msgType = state.uiMode === 'create' ? 'generate' : 'apply';

            parent.postMessage({ 
                pluginMessage: { 
                    type: msgType, 
                    payload: {
                        type: state.chartType,
                        mode: state.dataMode,
                        values: payloadValues,
                        rows: state.rows,
                        cols: state.cols
                    }
                } 
            }, '*');
        }

        ui.saveBtn.addEventListener('click', toggleMode);
        ui.csvInput.addEventListener('change', handleCsvUpload);
        ui.csvDeleteBtn.addEventListener('click', removeCsv);
        ui.mainCta.addEventListener('click', submitData);
        ui.rowInput.addEventListener('input', handleDimensionInput);
        ui.colInput.addEventListener('input', handleDimensionInput);
        
        ui.addColFixedBtn.addEventListener('click', addColumn);
        ui.addRowFixedBtn.addEventListener('click', addRow);

        // 초기 시작 (code.ts의 init 메시지를 기다림)
        // goToStep(1); 
    </script>
</body>
</html>